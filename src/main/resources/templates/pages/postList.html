<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="utf-8"></meta>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"></meta>
  <link rel="stylesheet" th:href="@{/res/layui/css/layui.css}"></link>
  <link rel="stylesheet" th:href="@{/res/css/global.css}"></link>
  <link rel="stylesheet" th:href="@{/bower_components/bootstrap/dist/css/bootstrap.min.css}"></link>
</head>
<body>
<script th:src="@{/webjars/jquery/3.4.1/jquery.js}"></script>
<script th:include="common/common :: script"></script>
<!---->
<div th:include="common/common :: commonHeader"></div>
<!--横-->
<div th:include="common/common :: navigation"></div>

<div class="layui-container">
  <div class="layui-row layui-col-space15">
    <div class="layui-col-md8">
      <div class="fly-panel" >
        <div class="fly-panel-title fly-filter">
          <table>
            <tr>
              <td> <div href="" class="layui-this" style="width:350px"><h1>文件列表</h1></div></td>
              <!--搜索框-->
                <td>
                     <form class="form-inline layui-form" th:action="@{/index/toFile}" type="post" >
                        <input type="text"  name="fileName"   placeholder="搜索帖子" autocomplete="off" class="layui-input" style="width:150px"/>
                     </form>
                </td>
               <td>
                 <button style="float: left" type="submit" class="layui-btn layui-btn-normal" >确认</button>
               </td>

            </tr>
             <!-- <shiro:hasRole name="manager">　　
                  <tr>
                      <a th:href="@{/file/toUpload}" style="color: white"  class="layui-btn">上传文件</a>
                      <a th:href="@{/user/toUserList}" style="color: white"  class="layui-btn">授权</a>
                  </tr>
              </shiro:hasRole>-->
          </table>
          <table class="layui-table">
              <thead>
              <tr>
                  <th>文件</th>
                  <th>文件大小</th>
                  <th>文件上传日期</th>
                  <th>下载</th>
                  <shiro:hasRole name="manager">
                  <th>操作</th>
                  </shiro:hasRole>
              </tr>
              </thead>
              <tbody>
              <div th:each="file:${files}">
                  <tr>
                      <td th:text="${file.fileName}"></td>
                      <td th:text="${file.size}"></td>
                      <td th:text="${file.uploadTime}"></td>
                      <td>
                          <a th:href="@{/file/downloadFile/{fileId}(fileId=${file.id})}" style="color: white;" th:download="@{/file/downloadFile/{fileId}(fileId=${file.id})}" class="layui-btn">下载</a>
                      </td>
                      <shiro:hasRole name="manager">
                          <td>
                              <button  th:id="'bt' + ${file.id}" th:value="${file.id}" onclick="delF(this.value)"  style="color: white;" class="layui-btn layui-btn-danger">删除</button>
                          </td>
                      </shiro:hasRole>
                  </tr>
              </div>

              </tbody>
          </table>

        <div style="text-align: center">
          <!--分页-->
          <div style="margin-top: 40px">
            <ul class="pagination" >
              <li th:class="${indexPage==1}?'disabled' : ''"><a th:href="@{'/index/toFile?indexPage=' + ${indexPage-1}  +'&fileName=' + ${fileName}  }">&laquo;</a></li>
              <li th:if="${indexPage-3 >=1}" ><a th:href="@{'/index/toFile?indexPage=' + ${indexPage-3}  +'&fileName=' + ${fileName}   }" th:text="${indexPage -3}" >1</a></li>
              <li th:if="${indexPage-2 >=1}" ><a th:href="@{'/index/toFile?indexPage=' + ${indexPage-2}  +'&fileName=' + ${fileName}     }" th:text="${indexPage -2}" >1</a></li>
              <li th:if="${indexPage-1 >=1}" ><a th:href="@{'/index/toFile?indexPage=' + ${indexPage-1}  +'&fileName=' + ${fileName}   }" th:text="${indexPage -1}" >1</a></li>
              <li class="active"><a href="#" th:text="${indexPage}" >1</a></li>
              <li th:if="${indexPage+1 <=totalPage}" ><a th:href="@{'/index/toFile?indexPage=' + ${indexPage+1}   +'&fileName=' + ${fileName}   }" th:text="${indexPage +1}" >1</a></li>
              <li th:if="${indexPage+2 <=totalPage}" ><a th:href="@{'/index/toFile?indexPage=' + ${indexPage+2}  +'&fileName=' + ${fileName}   }" th:text="${indexPage +2}" >1</a></li>
              <li th:if="${indexPage+3 <=totalPage}" ><a th:href="@{'/index/toFile?indexPage=' + ${indexPage+3}  +'&fileName=' + ${fileName}     }" th:text="${indexPage +3}" >1</a></li>
              <li th:class="${indexPage==totalPage}?'disabled' : ''" ><a th:href="@{'/index/toFile?indexPage=' + ${indexPage+1}   +'&fileName=' + ${fileName}   }" href="#">&raquo;</a></li>
            </ul>

          </div>

        </div>

      </div>
    </div>
  </div>
</div>

<div  th:include="common/common :: footer"></div>

<script th:src="@{/res/layui/layui.js}"></script>
<script>
  /*点赞*/

layui.config({
  version: "3.0.0",
  base: './res/mods/'
}).extend({
  fly: 'index'
}).use('fly');
</script>
<script type="text/javascript">
  $(function () {
    $("#s1").addClass("layui-this");
  });

  function delF(fileId) {
      $.ajax({
          url:"/file/delFile/"+fileId,
          type:"put",
          dataType:"json",
          cache:false,
          success:function(data){//ajax返回的数据
                $('#bt' + fileId).parent().parent().remove();
          },
          error:function (data) {
              layer.msg("请登录哦~")
          }

      });
  }
</script>
</body>
</html>