<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" th:href="@{/res/layui/css/layui.css}">
  <link rel="stylesheet" th:href="@{/res/css/global.css}">
  <link rel="stylesheet" th:href="@{/bower_components/bootstrap/dist/css/bootstrap.min.css}">
</head>
<body>
<script th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script th:include="common/common :: script"></script>
<!---->
<div th:include="common/common :: commonHeader"></div>
<!--横-->
<div th:include="common/common :: navigation"></div>

<div class="layui-container">
  <div class="layui-row layui-col-space15">
    <div class="layui-col-md8">
      <div class="fly-panel" style="margin-bottom: 0;">
          <form class="layui-form" action="">
              <div class="layui-form-item">
                  <div class="layui-input-block">
                      <input type="text" id="fileT" class="layui-input" placeholder="点击上传文件" onclick="clickInput()">
                      <input type="file" id="file" style="display: none" >
                  </div>
              </div>
              <div class="layui-form-item">
                  <label style="width: 200px;" class="layui-form-label">输入文件信息</label>
                  <div class="layui-input-block">
                      <input type="text" id="fileMsg" required  lay-verify="required" placeholder="文件信息" autocomplete="off" class="layui-input">
                  </div>
                  <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                      <span class="sr-only">40% complete (success)</span>
                  </div>
              </div>
              <div class="layui-form-item">
                  <div class="layui-input-block">
                      <button class="layui-btn" lay-submit lay-filter="formDemo" onclick="addFile()">立即上传</button>
                  </div>
              </div>
          </form>
        </div>

      </div>
    </div>
  </div>
</div>

<div  th:include="common/common :: footer"></div>

<script th:src="@{/res/layui/layui.js}"></script>
<script>
  /*点赞*/

layui.config({
  version: "3.0.0",
  base: '/res/mods/'
}).extend({
  fly: 'index'
}).use('fly');
</script>
<script type="text/javascript">
  $(function () {
    $(".layui-clear li").eq(2).addClass("layui-this");
  });
  function getFileName(o){
      var pos=o.lastIndexOf("\\");
      return o.substring(pos+1);
  }
  function clickInput(){
      $("#file").click();
  }
  //监听input
  $("#file").on("change",function (e) {
      var file = $("#file").val();
      var fileName = getFileName(file);
      console.log(fileName);
      $("#fileT").val(fileName);
  });
  
  function addFile() {
      var formData = new FormData();
      formData.append("file",$("#file")[0].files[0]);
      formData.append("fileMsg",$("#fileMsg").val());
      $.ajax({
          url:"/file/addFile",
          type:"POST",
          data:formData,
          contentType:false,
          processData:false,
          dataType:"json",
          async : false,
          mimeType:"multipart/form-data",
          xhr:function(){
              myXhr = $.ajaxSettings.xhr();
              if (myXhr.upload) {
                  myXhr.upload.addEventListener('progress',function (e) {
                        var curr = e.loaded;
                        var total = e.total;
                        process = curr/total*100;
                        $(".progress-bar").css("width",process+"%");
                  }, false);
              }
              return myXhr;
          }
  });
  }
</script>
</body>
</html>